#!/bin/bash

install() {
	if [ "$(pacman -Qsq yay-bin)" == "" ]; then
		echo "Yay is not installed on system. Installing it."
		if [ "$(pacman -Qsq git)" == "" ]; then
			echo "Git is not installed on system. Installing it and base-devel."
			pacman -S --needed --noconfirm git base-devel
		fi
		git clone https://aur.archlinux.org/yay-bin.git
		cd yay-bin
		makepkg -sri --noconfirm
		cd ../
	fi
	yay -S --noconfirm --needed $@
}

fonts() {
	case $1 in
		"install" | "i")
			install ttf-merriweather ttf-fira-sans noto-fonts-emoji powerline-fonts-git nerd-fonts-fira-mono
		;;
		"apply" | "a")
			if [ ! -d "$HOME/.config/fontconfig" ]; then
				mkdir ~/.config/fontconfig
			fi
			cp ./fonts.conf ~/.config/fontconfig/
			fc-cache
			print "Sans is: `fc-match sans`"
			print "Serif is: `fc-match serif`"
			print "Monospace is: `fc-match mono`"
		;;
		*)
			echo "help: ./build (f)fonts [(i)nstall|(a)pply]"
		;;
	esac
}

console() {
	case $1 in
		"install" | "i")
			install alacritty neovim python-pynvim git-delta-bin tmux starship-bin lsd-bin bat trash-cli
		;;
		"apply" | "a")
			if [ ! -d "$HOME/.local/bin" ]; then
				mkdir ~/.local/bin
			fi
			cp ./bashrc ~/.bashrc
			cp ./tmux.conf ~/.tmux.conf
			if [ ! -d "$HOME/.config/nvim" ]; then
				mkdir ~/.config/nvim
			fi
			if [ ! -d "$HOME/.config/autodark" ]; then
				mkdir ~/.config/autodark
			fi
			if [ ! -d "$HOME/.config/alacritty" ]; then
				mkdir ~/.config/alacritty
			fi
			cp gitconfig ~/.gitconfig
			cp -r dark ~/.config/autodark/
			cp -r light ~/.config/autodark/
			cp init.vim ~/.config/autodark/
			cp alacritty.yml ~/.config/autodark/
			cat ~/.config/autodark/alacritty.yml > ~/.config/alacritty/alacritty.yml
			cat ~/.config/autodark/init.vim > ~/.config/nvim/init.vim
			cat ~/.config/autodark/dark/alacritty.yml >> ~/.config/alacritty/alacritty.yml
			cat ~/.config/autodark/dark/init.vim >> ~/.config/nvim/init.vim
			cat ~/.config/autodark/dark/init.vim >> ~/.config/nvim/init.vim
			if [ ! -d "$HOME/.vim/bundle/Vundle.vim" ]; then
				echo "Vundle not found. Installing."
				git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim
			fi
			nvim +PluginInstall +qall
			source ~/.bashrc
		;;
		*)
			echo "help: ./build (c)onsole [(i)nstall|(a)pply]"
		;;
	esac
}

case $1 in
	"fonts" | "f")
		fonts $2
	;;
	"console" | "c")
		console $2
	;;
	"mouse" | "m")
		sudo cp ./90-mx-anywhere-on.rule /etc/udev/rules.d/
	;;
	"autodark" | "a")
		echo "TODO"
	;;
	"everything" | "e")
		$0 fonts install
		$0 fonts apply
		$0 console install
		$0 console apply
	;;
	*)
		echo "./build [(c)onsole | (f)fonts | (a)autodark | (e)verything | (m)ouse]"
	;;
esac
